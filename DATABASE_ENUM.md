# Database Enumeration Module

## Overview
The database enumeration module (`db_enum.py`) provides automated enumeration capabilities for common database services including:
- **MySQL** (Port 3306)
- **PostgreSQL** (Port 5432)
- **MSSQL** (Microsoft SQL Server, Port 1433)

## Features

### Automatic Detection
The module automatically detects the database type based on the port number and performs appropriate enumeration.

### Enumeration Capabilities

#### MySQL Enumeration
- **Banner Grabbing**: Retrieves MySQL server version from the initial handshake packet
- **Version Detection**: Parses and extracts MySQL version information
- **Authentication Check**: Tests if anonymous/empty credentials are accepted

#### PostgreSQL Enumeration
- **Version Detection**: Attempts to retrieve PostgreSQL version
- **Authentication Check**: Tests for default/weak authentication

#### MSSQL Enumeration
- **Version Detection**: Retrieves Microsoft SQL Server version
- **Banner Information**: Extracts server banner details
- **Authentication Check**: Tests for default SA account access

## Usage

### Automatic Integration
When you run the reconnaissance toolkit, database enumeration will automatically trigger when ports 3306, 5432, or 1433 are found open:

```bash
python recon_toolkit.py -t <target>
```

### Manual Usage
You can also use the database enumeration module directly in your Python scripts:

```python
from modules.db_enum import enumerate_database

# Enumerate MySQL
results = enumerate_database('192.168.1.100', 3306)

# Enumerate PostgreSQL
results = enumerate_database('192.168.1.100', 5432)

# Enumerate MSSQL
results = enumerate_database('192.168.1.100', 1433)
```

## Optional Dependencies

For enhanced functionality, you can install database-specific Python libraries:

```bash
# For MySQL enumeration
pip install mysql-connector-python

# For PostgreSQL enumeration
pip install psycopg2-binary

# For MSSQL enumeration
pip install pymssql
```

**Note**: The module will work without these libraries but with limited functionality. It will still perform:
- Port accessibility checks
- Banner grabbing (where applicable)
- Basic connectivity tests

With the libraries installed, you get:
- Full version detection
- Detailed authentication testing
- Enhanced error reporting

## Output Format

The enumeration results are returned as a dictionary with the following structure:

```python
{
    'port': 3306,
    'service': 'database (mysql)',
    'db_type': 'mysql',
    'version': '8.0.27',
    'banner': '8.0.27-0ubuntu0.20.04.1',
    'accessible': True,
    'authentication_required': True,
    'error': None
}
```

## Security Considerations

### Ethical Use Only
This tool is designed for:
- Authorized penetration testing
- CTF competitions
- Security assessments with explicit permission
- Educational purposes in controlled environments

### What It Does NOT Do
- **No brute forcing**: Does not attempt password guessing
- **No exploitation**: Only performs reconnaissance
- **No data extraction**: Does not attempt to read database contents
- **Minimal intrusion**: Uses lightweight connection attempts

### Best Practices
1. Always obtain written authorization before scanning
2. Use only on systems you own or have permission to test
3. Be aware that connection attempts may be logged
4. Respect rate limits and avoid overwhelming target systems

## Configuration

You can adjust the database enumeration timeout in `config.py`:

```python
# Database enumeration settings
DB_TIMEOUT = 30  # seconds
```

## Troubleshooting

### "Port is not accessible"
- Verify the target IP/hostname is correct
- Check if a firewall is blocking the connection
- Ensure the database service is running

### "Unknown database type"
- The port number doesn't match standard database ports
- You may need to manually specify the database type

### Missing Optional Libraries
If you see warnings about missing libraries:
```
WARNING: mysql-connector-python not installed, skipping auth check
```

Install the required library:
```bash
pip install mysql-connector-python
```

## Integration with Reports

Database enumeration results are automatically included in both JSON and HTML reports generated by the toolkit. The reports will show:
- Database type and version
- Port information
- Authentication status
- Any errors encountered

## Examples

### Example 1: Scanning a MySQL Server
```bash
python recon_toolkit.py -t 192.168.1.100
```

If port 3306 is open, the toolkit will:
1. Detect it as MySQL
2. Grab the server banner
3. Extract version information
4. Test authentication requirements
5. Include results in the final report

### Example 2: Scanning Multiple Database Ports
```bash
python recon_toolkit.py -t database-server.local --ports 1433,3306,5432
```

This will scan all three common database ports and enumerate any that are open.

### Example 3: Quick Scan (Skip Enumeration)
```bash
python recon_toolkit.py -t 192.168.1.100 --quick
```

This will only perform port scanning without deep enumeration.

## Future Enhancements

Potential additions for future versions:
- MongoDB enumeration (Port 27017)
- Redis enumeration (Port 6379)
- Oracle Database enumeration (Port 1521)
- Cassandra enumeration (Port 9042)
- Default credential testing (with explicit user consent)
- Database-specific vulnerability checks
